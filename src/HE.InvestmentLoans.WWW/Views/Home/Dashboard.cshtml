@using HE.InvestmentLoans.Contract.Application.Queries;
@using HE.InvestmentLoans.WWW.Routing
@using HE.Investments.Common.Gds
@using HE.Investments.Common.WWW.Helpers
@model GetDashboardDataQueryResponse
@{
    ViewData["Title"] = "Home Page";
    ViewBag.Breadcrumbs = BreadcrumbsBuilder
        .New()
        .WithOrganisations()
        .WithOrganisation(Model.AccountName)
        .WithLuhbfApplications()
        .Build();
}

<gds-column width="ColumnWidth.Full">
    <div class="govuk-!-margin-top-4">
        @await Html.PartialAsync("_Notification")
    </div>

    <gds-h1 class="govuk-!-margin-top-6" size="ControlSize.L">
        @Model.AccountName LUHBF applications
    </gds-h1>

    <gds-h2 size="ControlSize.M">
        Your applications
    </gds-h2>


    @if (Model.LoanApplications.Count <= 0)
    {
        <p class="govuk-body govuk-!-margin-bottom-3">No applications, start new application below.</p>
    }
    else
    {
        <table class="govuk-table">
            <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header govuk-!-width-one-third">Name</th>
                <th scope="col" class="govuk-table__header govuk-!-width-one-third">Status</th>
                <th scope="col" class="govuk-table__header govuk-!-width-one-third">Last updated</th>
            </tr>
            </thead>
            <tbody class="govuk-table__body">
            @foreach (var application in Model.LoanApplications)
            {
                <tr class="govuk-table__row">
                    <td class="govuk-table__cell">
                        <span class="app-task-list__task-name">
                            <strong>
                                <a href="@Url.Action("ApplicationDashboard", "LoanApplicationV2", new { id = application.Id.Value })" id=@($"open-application-link-{application.Id.Value}")>@application.ApplicationName.Value</a>
                            </strong>
                        </span>
                    </td>

                    <td class="govuk-table__cell">
                        <application-status-loans-tag application-status="@application.Status"></application-status-loans-tag>
                    </td>

                    <td class="govuk-table__cell">@DateHelper.DisplayAsUkFormatDateTime(application.LastModificationDate) @(!string.IsNullOrEmpty(application.LastModifiedBy) ? $"by {application.LastModifiedBy}" : string.Empty)</td>

                </tr>
            }
            </tbody>
        </table>
    }


    <div class="govuk-!-padding-top-8">
        <gds-h3 size="ControlSize.M">
            Start new Home Building Fund application
        </gds-h3>
        <p class="govuk-body govuk-!-margin-bottom-3">You can start a new application here. This will not impact any of your previous applications.</p>

        <link-button action-url="/application" id="start-application-link">
            Start new application
        </link-button>
    </div>
</gds-column>
