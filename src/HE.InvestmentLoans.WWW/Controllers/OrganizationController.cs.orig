using HE.InvestmentLoans.BusinessLogic.ViewModel;
<<<<<<< HEAD
using HE.Investments.Organisation.CompaniesHouse;
using HE.Investments.Organisation.CompaniesHouse.Contract;
=======
using HE.InvestmentLoans.Contract.Organization;
using MediatR;
>>>>>>> fc5b6e6 (WIP)
using Microsoft.AspNetCore.Mvc;

namespace HE.InvestmentLoans.WWW.Controllers;

[Route("organization")]
public class OrganizationController : Controller
{
<<<<<<< HEAD
    private readonly ICompaniesHouseApi _companiesHouseApi;

    public OrganizationController(ICompaniesHouseApi companiesHouseApi)
    {
        _companiesHouseApi = companiesHouseApi;
=======
    private readonly IMediator _mediator;

    public OrganizationController(IMediator mediator)
    {
        _mediator = mediator;
>>>>>>> fc5b6e6 (WIP)
    }

    [HttpGet("search")]
    public IActionResult SearchOrganization()
    {
        return View();
    }

    [HttpPost("search")]
    public async Task<IActionResult> SearchOrganizationPost(OrganizationViewModel organization)
    {
        return RedirectToAction(nameof(SelectOrganization), new { searchPhrase = organization.Name });
    }

    [HttpGet("select")]
    public async Task<IActionResult> SelectOrganization([FromQuery] string searchPhrase)
    {
        var response = await _mediator.Send(new SearchOrganizations(searchPhrase));

        return View(response.Result);
    }

    [HttpPost("select")]
    public async Task<IActionResult> SelectOrganizationPost(OrganizationViewModel organization)
    {
        return View();
    }

    [HttpGet("no-match-found")]
    public IActionResult NoMatchFound()
    {
        return View();
    }

    [HttpGet("dev/search")]
    public async Task<CompaniesHouseSearchResult> SearchOrganizationDemo(string companyName, CancellationToken cancellationToken = default)
    {
        return await _companiesHouseApi.Search(companyName, null, cancellationToken);
    }

    [HttpGet("dev/search-by-company-name")]
    public async Task<CompaniesHouseGetByCompanyNumberResult> SearchOrganizationCompanyDemo(string companyNumber, CancellationToken cancellationToken = default)
    {
        return await _companiesHouseApi.GetByCompanyNumber(companyNumber, cancellationToken);
    }
}
