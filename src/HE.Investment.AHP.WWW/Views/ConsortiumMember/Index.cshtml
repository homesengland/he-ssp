@using HE.Investment.AHP.WWW.Views.ConsortiumMember.Const
@using HE.Investments.Common.WWW.Components.PageHeader
@using HE.Investment.AHP.WWW.Routing
@using HE.Investment.AHP.WWW.Views.Shared.Components.ReturnToAccountLink
@using HE.Investments.AHP.Consortium.Contract
@using HE.Investments.AHP.Consortium.Contract.Enums
@using HE.Investments.Common.Gds
@using HE.Investments.Common.WWW.Components.SummaryList
@using HE.Investments.Common.WWW.TagHelpers
@model HE.Investments.AHP.Consortium.Contract.ConsortiumDetails
@{
    ViewData["Title"] = ConsortiumMemberPageTitles.ConsortiumManagement(Model.LeadPartner.Details.Name);
    ViewBag.Breadcrumbs = AhpBreadcrumbsBuilder
        .New()
        .WithApplicationsList()
        .Build();

    var contractedMembers = Model.Members
        .Where(x => x.Status == ConsortiumMemberStatus.Active)
        .Select(x => new SummaryListItem(x.Details.Name))
        .ToList();

    var pendingConsortiumMembers = Model.Members
        .Where(x => x.Status == ConsortiumMemberStatus.PendingAddition)
        .Select(x => new SummaryListItem(x.Details.Name, new[] { new SummaryListItemAction("Cancel request", RemoveMemberUrlFactory(x)) }))
        .ToList();

    string RemoveMemberUrlFactory(ConsortiumMemberDetails member) => Url.Action("RemoveMember", "ConsortiumMember", new { consortiumId = Model.ConsortiumId.Value, memberId = member.OrganisationId.ToString() }) ?? string.Empty;
}

<div class="govuk-grid-column-two-thirds">
    <vc:page-header title="@ConsortiumMemberPageTitles.ConsortiumManagement(Model.LeadPartner.Details.Name)"/>

    <gds-h2>Add a new member</gds-h2>
    <gds-p>To add a new member, fill out their details and the request will be reviewed.</gds-p>
    <link-button
        button-type="@ButtonType.Standard"
        action-url="@Url.Action("SearchOrganisation", new { consortiumId = Model.ConsortiumId.Value })">
        Add new member
    </link-button>
</div>

@if (contractedMembers.Any())
{
    <vc:summary-list header="Contracted consortium members"
                     paragraph="These members have been approved and added to the consortium. You can request to remove or change the members details."
                     items="@contractedMembers"/>
}

@if (pendingConsortiumMembers.Any())
{
    <vc:summary-list header="Pending consortium members"
                     paragraph="New members will be shown here until they are approved internally. You can cancel a request below."
                     items="@pendingConsortiumMembers"/>
}

<div class="govuk-grid-column-two-thirds govuk-!-margin-top-6">
    <gds-h2>Changing or deleting this consortium</gds-h2>
    <gds-p>If you need to make changes to, or delete this consortium, contact Homes England. We will do this for you.</gds-p>

    <div class="govuk-!-margin-top-8">
        <vc:return-to-account-link/>
    </div>
</div>
