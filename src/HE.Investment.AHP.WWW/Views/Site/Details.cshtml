@using HE.Investments.Common.Extensions
@using HE.Investments.Common.Gds
@using HE.Investments.Common.Messages
@using HE.Investments.Common.WWW.Components.PageHeader
@using HE.Investments.Common.WWW.Components.SectionSummaryItem
@model HE.Investment.AHP.Contract.Site.SiteDetailsModel
@{
    ViewData["Title"] = Model.SiteName;
}
<div class="govuk-grid-column-full">
    <gds-back-link href="@Url.Action("Index", "Site")" class="govuk-!-margin-bottom-8"></gds-back-link>
    <vc:page-header title="@Model.SiteName" caption="@Model.OrganisationName"/>

    @if (!string.IsNullOrWhiteSpace(Model.LocalAuthorityName))
    {
        <div class="govuk-!-width-two-thirds govuk-!-margin-bottom-8">
            <gds-summary-list>
                <vc:section-summary-item
                    name="Local authority"
                    values="@Model.LocalAuthorityName.ToOneElementList()"
                    action-url="@string.Empty"
                    is-editable="@false"/>
            </gds-summary-list>
        </div>
    }

    <div class="govuk-!-width-two-thirds">
        <gds-h2>View details of this site</gds-h2>
        <gds-p>View or edit this site's details. You cannot edit the details for a site if an application connected to it has already been submitted.</gds-p>
        <link-button action-url="@Url.Action("StartSite", "Site", new { siteId = Model.SiteId.Value })" button-type="@ButtonType.Secondary">
            View details
        </link-button>
    </div>

    @if (Model.Applications.TotalItems > 0)
    {
        <div class="govuk-!-margin-top-6">
            <gds-h2>Applications on this site</gds-h2>
            <gds-p>View or manage existing applications for this site.</gds-p>

            <table class="govuk-table">
                <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th scope="col" class="govuk-table__header govuk-!-width-one-third">Application name</th>
                    <th scope="col" class="govuk-table__header">Application tenure</th>
                    <th scope="col" class="govuk-table__header">No of homes</th>
                    <th scope="col" class="govuk-table__header">Status</th>
                </tr>
                </thead>
                <tbody class="govuk-table__body">
                @foreach (var application in Model.Applications.Items)
                {
                    <tr class="govuk-table__row">
                        <td class="govuk-table__cell">
                            <span class="app-task-list__task-name">
                                <strong>
                                    <a data-testId="application-@application.Id.Value" href="@Url.Action("TaskList", "Application", new { applicationId = application.Id.Value })">@application.Name</a>
                                </strong>
                            </span>
                        </td>
                        <td class="govuk-table__cell">
                            @application.Tenure.GetDescription()
                        </td>
                        <td class="govuk-table__cell">
                            @(application.NumberOfHomes?.ToString() ?? GenericMessages.NotProvided)
                        </td>
                        <td class="govuk-table__cell">
                            <application-status-tag application-status="@application.Status"></application-status-tag>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
            <he-pagination base-url="@Model.SiteId.Value" page="@Model.Applications.CurrentPage" items-per-page=@Model.Applications.ItemsPerPage total-items="@Model.Applications.TotalItems"></he-pagination>
        </div>
    }

    <gds-p>
        To begin a new application, return to <gds-link data-testId="application-list" href="@Url.Action("Index", "Application")">your list of applications</gds-link>.
    </gds-p>
</div>
